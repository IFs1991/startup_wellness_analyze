バックエンド分析システム:
  概要: "Startup Wellness プログラムにおける統合分析システム。スタートアップ企業の健康状態、財務パフォーマンス、組織成長など様々な側面を分析する機能群。"

  基盤モジュール:
    BaseAnalyzer:
      説明: "分析モジュールの基底クラス。共通機能を提供。"
      機能:
        - データ検証
        - Firestoreとの連携
        - 分析結果の保存
        - エラーハンドリング

    AnalysisError:
      説明: "分析処理に関する例外クラス。分析中のエラーを統一的に扱う。"

    ユーティリティ:
      PlotUtility:
        説明: "可視化関連の共通ユーティリティ"
        機能:
          - 基本プロット生成
          - ヒストグラム生成
          - 残差プロット生成
          - プロットのBase64エンコード

      StatisticsUtility:
        説明: "統計計算の共通ユーティリティ"
        機能:
          - 信頼区間計算
          - 歪度計算
          - 尖度計算

      HealthImpactWeightUtility:
        説明: "健康影響度の重み付け係数に関するユーティリティ"
        機能:
          - 業種・役職別の健康影響度重み取得
          - 役職名からレベル取得

  統計分析:
    DescriptiveStatsCalculator:
      説明: "記述統計量を計算するモジュール"
      機能:
        - 基本統計量（平均、中央値、標準偏差など）の計算
        - ARIMA評価指標の計算
      入力: "VASデータや損益計算書データ"

    CorrelationAnalyzer:
      説明: "相関分析を行うモジュール"
      機能:
        - VASデータと財務データの相関分析
      入力: "VASデータと損益計算書データ"
      出力: "相関行列とメタデータ"

    TimeSeriesAnalyzer:
      説明: "時系列分析を行うモジュール"
      機能:
        - ARIMAモデルによる時系列分析
      入力: "時系列データ"
      出力: "モデルの要約統計量とパラメータ"

    SurvivalAnalyzer:
      説明: "生存時間分析を行うモジュール"
      機能:
        - Kaplan-Meier法による生存曲線分析
      入力: "イベント発生までの時間と発生有無を含むデータ"
      出力: "生存確率の時系列と平均生存時間"

    AssociationAnalyzer:
      説明: "アソシエーション分析を行うモジュール"
      機能:
        - アプリオリアルゴリズムによる頻出アイテムセット抽出
        - アソシエーションルールの生成
      入力: "トランザクションデータ"
      出力: "頻出アイテムセットとアソシエーションルール"

  機械学習・AI分析:
    PCAAnalyzer:
      説明: "主成分分析を行うモジュール"
      機能:
        - 多次元データの次元削減
        - 主成分スコアの計算
      入力: "多変量データ"
      出力: "主成分得点とその寄与率"

    ClusterAnalyzer:
      説明: "クラスタリング分析を行うモジュール"
      機能:
        - K-means、DBSCAN、階層型クラスタリング
        - クラスタごとの特性分析
      入力: "多変量データ"
      出力: "クラスタラベルと統計情報"

    TextMiner:
      説明: "テキスト分析を行うモジュール"
      機能:
        - 感情分析
        - テキストのトークン化
        - キーワード抽出
      入力: "テキストデータ"
      出力: "感情スコア、単語数、キーワード"

    PredictiveModelAnalyzer:
      説明: "予測モデルを構築・評価するモジュール"
      機能:
        - 複数アルゴリズムの比較（線形回帰、ランダムフォレストなど）
        - モデル評価と特徴量重要度分析
        - 時系列予測
      入力: "特徴量と目的変数を含むデータセット"
      出力: "予測モデルと評価指標"

  因果分析:
    CausalInferenceAnalyzer:
      説明: "因果推論分析を行うモジュール"
      機能:
        - 差分の差分法(DiD)
        - 合成コントロール法
        - CausalImpactによる時系列因果推論
        - 異質処理効果の推定
      入力: "処置群・対照群データ、時系列データ"
      出力: "因果効果の推定値と信頼区間"

    CausalStructureAnalyzer:
      説明: "因果構造分析を行うモジュール"
      機能:
        - PCアルゴリズムによる因果構造学習
        - ベイジアンネットワークの構築
        - 因果効果の推定
      入力: "多変量データ"
      出力: "因果グラフと効果推定"

    BayesianInferenceAnalyzer:
      説明: "ベイズ推論による分析を行うモジュール"
      機能:
        - 事前分布の更新
        - 事後分布と信用区間の計算
        - PyMCによる高度なベイズモデリング
      入力: "時系列データと事前分布"
      出力: "事後分布パラメータと予測値"

  シミュレーション:
    MonteCarloSimulator:
      説明: "モンテカルロシミュレーションを行うモジュール"
      機能:
        - 汎用的なモンテカルロシミュレーション
        - 信頼区間の計算
        - 結果の可視化
      入力: "初期値と遷移関数"
      出力: "シミュレーション結果と統計情報"

    SensitivityAnalyzer:
      説明: "感度分析を行うモジュール"
      機能:
        - パラメータの感度分析
        - トルネードチャート生成
        - 重要パラメータの特定
      入力: "モデル関数とパラメータ範囲"
      出力: "感度分析結果とチャート"

    StartupSurvivabilityAnalyzer:
      説明: "スタートアップの生存性を分析するモジュール"
      機能:
        - 現金枯渇確率の計算
        - 生存曲線の作成
        - シナリオ分析
      入力: "財務パラメータ"
      出力: "生存確率予測と統計情報"

  ビジネス・財務分析:
    FinancialAnalyzer:
      説明: "財務分析を行うモジュール"
      機能:
        - バーンレート計算
        - LTV/CAC分析
        - 成長指標の計算
        - 資金調達効率分析
      入力: "財務データ、顧客データ"
      出力: "財務分析結果と指標"

    MarketAnalyzer:
      説明: "市場分析を行うモジュール"
      機能:
        - TAM/SAM/SOMの推定
        - 競合マッピング
        - 市場トレンド分析
        - 競合追跡
      入力: "市場データ、競合データ"
      出力: "市場分析結果と競合ポジショニング"

    VCROICalculator:
      説明: "VC向けROI計算を行うモジュール"
      機能:
        - 基本ROI計算
        - リスク調整済みROI計算
        - 健康影響を考慮したROI計算
        - 役職別重み付けROI計算
      入力: "収益変化、企業価値変化、プログラムコスト、投資コスト"
      出力: "ROI値と関連指標"

    HealthInvestmentEffectIndexCalculator:
      説明: "健康投資効果指数(HIEI)を計算するモジュール"
      機能:
        - VAS改善度、生産性向上率、離職率減少に基づく指数計算
        - エコシステム影響度計算
        - 業界ベンチマーク比較
      入力: "VASデータ、生産性データ、離職率データ"
      出力: "HIEI値と詳細指標"

  組織・チーム分析:
    TeamAnalyzer:
      説明: "チーム・組織分析を行うモジュール"
      機能:
        - 創業チーム評価
        - 組織成長分析
        - 人材獲得力評価
        - 文化・エンゲージメント分析
        - 組織ネットワーク分析
      入力: "創業者データ、従業員データ、エンゲージメントデータ"
      出力: "チーム強度スコア、組織健全性指標"

    PortfolioNetworkAnalyzer:
      説明: "ポートフォリオネットワーク分析を行うモジュール"
      機能:
        - ネットワークグラフ構築
        - 中心性指標の計算
        - コミュニティ検出
        - 因果構造分析の統合
      入力: "企業間関係データ"
      出力: "ネットワーク指標と可視化結果"

    KnowledgeTransferIndexCalculator:
      説明: "知識移転指数を計算するモジュール"
      機能:
        - ネットワーク中心性に基づく知識移転指数計算
        - 業界別知識移転分析
        - ベストプラクティス共有度の分析
      入力: "企業間ネットワークデータ、施策採用データ"
      出力: "知識移転指数と影響力者情報"

統合機能:
  非同期処理:
    説明: "BigQueryServiceを利用した非同期データ処理をサポート"

  クラウドファンクション連携:
    説明: "Google Cloud Functionsと連携するためのエントリーポイント関数を提供"

  可視化サポート:
    説明: "様々な分析結果の可視化機能（グラフ、チャートなど）を提供"

  データ永続化:
    説明: "Firestoreを使用した分析結果の永続化をサポート"

# 新規追加: テストモジュール
テスト項目:
  共通テスト:
    説明: "分析モジュール共通のテスト項目"
    テスト環境準備:
      - BigQueryServiceモック
      - FirestoreServiceモック
      - サンプルデータセット準備
    テスト内容:
      - 初期化パラメータ検証
      - エラーハンドリング検証
      - データ検証ロジック

  ファイナンシャルアナライザーテスト:
    説明: "財務分析モジュールのテスト項目"
    テスト対象: "FinancialAnalyzer"
    テストケース:
      - バーンレート計算:
          機能: "calculate_burn_rate"
          検証項目:
            - 月次バーンレート計算の正確性
            - 四半期バーンレート計算の正確性
            - ランウェイ月数計算の正確性
            - 異常値に対する例外処理
      - バーンレートベンチマーク比較:
          機能: "compare_burn_rate_to_benchmarks"
          検証項目:
            - 業界別比較の正確性
            - 存在しない業界への対応
            - 性能スコア計算の正確性
      - ユニットエコノミクス分析:
          機能: "analyze_unit_economics"
          検証項目:
            - LTV/CAC計算の正確性
            - 顧客継続率計算の正確性
            - 投資回収期間計算の正確性
      - 成長メトリクス計算:
          機能: "calculate_growth_metrics"
          検証項目:
            - MRR/ARR計算の正確性
            - 成長率計算の正確性
            - 予測成長曲線の生成
      - 資金調達効率分析:
          機能: "analyze_funding_efficiency"
          検証項目:
            - 資金調達効率スコア計算
            - 調達ラウンド間の効率比較
            - 業界平均との比較

  ベイジアン推論アナライザーテスト:
    説明: "ベイズ推論分析モジュールのテスト項目"
    テスト対象: "BayesianInferenceAnalyzer"
    テストケース:
      - 線形モデルフィット:
          機能: "fit_linear_model"
          検証項目:
            - モデル係数の推定精度
            - 予測精度の評価
            - 診断メトリクスの正確性
            - 結果の可視化機能
      - 階層モデルフィット:
          機能: "fit_hierarchical_model"
          検証項目:
            - グループ効果の推定精度
            - グループ間比較の正確性
            - 診断メトリクスの正確性
      - ベイズファクター計算:
          機能: "calculate_bayes_factor"
          検証項目:
            - モデル比較の正確性
            - エビデンス強度の評価精度
      - 信念更新:
          機能: "update_beliefs"
          検証項目:
            - 事前信念の更新精度
            - 事後分布の計算精度
            - データ蓄積による更新効果

  モンテカルロシミュレーターテスト:
    説明: "モンテカルロシミュレーションモジュールのテスト項目"
    テスト対象: "MonteCarloSimulator"
    テストケース:
      - 基本シミュレーション:
          機能: "run_simulation"
          検証項目:
            - シミュレーション結果の分布特性
            - 反復回数の影響評価
            - 乱数シード固定時の再現性
      - 資金枯渇シミュレーション:
          機能: "simulate_cash_runway"
          検証項目:
            - 資金枯渇確率計算の正確性
            - シナリオ分析の結果検証
            - パラメータ感度分析
      - 投資リターンシミュレーション:
          機能: "simulate_investment_returns"
          検証項目:
            - リターン分布の正確性
            - リスク指標計算の正確性
            - 期待リターン計算の正確性

  スタートアップ生存性アナライザーテスト:
    説明: "スタートアップ生存性分析モジュールのテスト項目"
    テスト対象: "StartupSurvivabilityAnalyzer"
    テストケース:
      - 生存曲線分析:
          機能: "analyze_survival_curve"
          検証項目:
            - 生存確率計算の正確性
            - 信頼区間計算の正確性
            - 複数シナリオ比較の正確性
      - 現金枯渇リスク評価:
          機能: "assess_cash_burn_risk"
          検証項目:
            - リスクスコア計算の正確性
            - 閾値設定の妥当性
            - 早期警告指標の感度
      - 成長段階別生存率分析:
          機能: "analyze_stage_survival_rates"
          検証項目:
            - 段階別生存率の差異検証
            - 転換点特定の正確性
            - 業界平均との比較精度

  クラスターアナライザーテスト:
    説明: "クラスタリング分析モジュールのテスト項目"
    テスト対象: "ClusterAnalyzer"
    テストケース:
      - K-meansクラスタリング:
          機能: "perform_kmeans_clustering"
          検証項目:
            - クラスター数最適化の正確性
            - クラスター中心の計算精度
            - シルエットスコア計算の正確性
      - DBSCANクラスタリング:
          機能: "perform_dbscan_clustering"
          検証項目:
            - 密度ベースクラスタリングの精度
            - パラメータ選択の妥当性評価
            - 外れ値検出の正確性
      - 階層型クラスタリング:
          機能: "perform_hierarchical_clustering"
          検証項目:
            - デンドログラム生成の正確性
            - クラスター数決定の正確性
            - クラスター特性の分析精度

  チームアナライザーテスト:
    説明: "チーム分析モジュールのテスト項目"
    テスト対象: "TeamAnalyzer"
    テストケース:
      - 創業チーム評価:
          機能: "evaluate_founding_team"
          検証項目:
            - 多様性スコア計算の正確性
            - 経験評価の正確性
            - 相補性評価の正確性
      - 組織成長分析:
          機能: "analyze_org_growth"
          検証項目:
            - 成長率計算の正確性
            - 効率性指標の正確性
            - 予測モデルの精度
      - チーム健全性評価:
          機能: "evaluate_team_health"
          検証項目:
            - エンゲージメントスコア計算の正確性
            - 離職リスク予測の精度
            - 健全性指標の総合評価

  ポートフォリオネットワークアナライザーテスト:
    説明: "ポートフォリオネットワーク分析モジュールのテスト項目"
    テスト対象: "PortfolioNetworkAnalyzer"
    テストケース:
      - ネットワーク中心性分析:
          機能: "analyze_centrality"
          検証項目:
            - 次数中心性計算の正確性
            - 固有ベクトル中心性計算の正確性
            - 媒介中心性計算の正確性
      - コミュニティ検出:
          機能: "detect_communities"
          検証項目:
            - コミュニティ検出アルゴリズムの精度
            - モジュラリティ計算の正確性
            - コミュニティ特性の分析精度
      - 影響伝播シミュレーション:
          機能: "simulate_influence_propagation"
          検証項目:
            - 伝播モデルの正確性
            - 伝播経路の分析精度
            - 伝播速度の評価精度

  因果推論アナライザーテスト:
    説明: "因果推論分析モジュールのテスト項目"
    テスト対象: "CausalInferenceAnalyzer"
    テストケース:
      - 差分の差分分析:
          機能: "perform_did_analysis"
          検証項目:
            - 処置効果推定の正確性
            - 並行トレンド仮定の検証
            - 標準誤差計算の正確性
      - CausalImpact分析:
          機能: "perform_causal_impact_analysis"
          検証項目:
            - 介入効果推定の正確性
            - 反実仮想予測の精度
            - 累積効果計算の正確性
      - 異質処理効果推定:
          機能: "estimate_heterogeneous_treatment_effects"
          検証項目:
            - サブグループ効果推定の正確性
            - 交互作用効果の検出精度
            - メタラーナーの性能評価

テスト実行環境:
  準備:
    説明: "テスト環境のセットアップ手順"
    手順:
      - PYTHONPATH設定
      - 環境変数設定（TESTING=True）
      - 必要なライブラリインストール（pytest, pytest-asyncio, pytest-cov）

  実行方法:
    説明: "テスト実行コマンドとオプション"
    コマンド:
      - 全テスト実行: "python -m backend.tests.run_analysis_tests"
      - 特定テスト実行: "python -m backend.tests.run_analysis_tests --files test_financial_analyzer.py"
      - カバレッジ測定: "python -m backend.tests.run_analysis_tests --coverage --html-report"